# MyHomeManager 開発ガイドライン

このドキュメントは、MyHomeManagerの開発における標準的な方針、規約、ベストプラクティスを定義します。
**すべての開発・修正作業は、このガイドラインに従って実施してください。**

---

## 目次
1. [プロジェクト概要](#プロジェクト概要)
2. [技術スタック](#技術スタック)
3. [アーキテクチャ方針](#アーキテクチャ方針)
4. [コーディング規約](#コーディング規約)
5. [ファイル構成](#ファイル構成)
6. [データ管理](#データ管理)
7. [セキュリティ](#セキュリティ)
8. [UI/UX設計](#uiux設計)
9. [テスト方針](#テスト方針)
10. [ドキュメント管理](#ドキュメント管理)

---

## プロジェクト概要

MyHomeManagerは、家庭の各種管理を支援するWebアプリケーションです。

### 設計理念
- **シンプル性**: 複雑な機能よりも、使いやすさを優先
- **オフライン優先**: ローカルストレージを活用し、ネットワーク不要
- **軽量性**: フレームワークに依存せず、Vanilla JavaScriptで実装
- **プライバシー**: データは全てブラウザ内に保存、外部送信なし

---

## 技術スタック

### フロントエンド
- **HTML5**: セマンティックなマークアップ
- **CSS3**: Vanilla CSS（フレームワーク不使用）
- **JavaScript**: ES6+、Vanilla JavaScript

### データ管理
- **LocalStorage API**: ブラウザベースのデータ永続化
- **JSON**: データシリアライゼーション形式

### 外部ライブラリ
- **Chart.js 4.4.0**: グラフ描画（必要なページのみ）

### 禁止事項
- ❌ フロントエンドフレームワーク（React, Vue, Angularなど）の使用
- ❌ CSSフレームワーク（Bootstrap, Tailwindなど）の使用
- ❌ バックエンドAPIへの依存
- ❌ サーバーサイド処理

---

## アーキテクチャ方針

### 1. ファイル分離原則
- **HTML、CSS、JavaScriptは必ず別ファイルに分離**
- インラインスタイルやインラインスクリプトは使用しない
- 各ページは独立したファイルセット（HTML、CSS、JS）を持つ

### 2. IIFE パターンの使用
すべてのJavaScriptファイルは、即時関数（IIFE）でラップしてグローバルスコープの汚染を防ぐ。

```javascript
(function () {
  'use strict';
  
  // コードをここに記述
  
})();
```

### 3. モジュール性
- 各ページのロジックは独立して動作すること
- 共通機能（サイドバー制御など）は各ファイル内に実装

### 4. データフロー
```
ユーザー入力 → バリデーション → データ更新 → LocalStorage保存 → UI再描画
```

---

## コーディング規約

### JavaScript

#### 命名規則
- **変数・関数**: キャメルケース（`camelCase`）
  ```javascript
  const userName = '太郎';
  function getUserData() { ... }
  ```

- **定数**: 大文字スネークケース（`UPPER_SNAKE_CASE`）
  ```javascript
  const STORAGE_KEY = 'cashbookEntries';
  const MAX_ENTRIES = 1000;
  ```

- **クラス**: パスカルケース（`PascalCase`）
  ```javascript
  class DataManager { ... }
  ```

#### インデント
- **スペース2個**を使用
- タブ文字は使用しない

#### コメント
- **日本語**で記述
- 複雑なロジックには必ずコメントを付ける
```javascript
// 受取系の種別を定義（プラス表示）
const receiveTypes = ['香典', 'お祝い', 'お見舞い', 'お年玉'];
```

#### 関数設計
- **単一責任の原則**: 1つの関数は1つの役割のみ
- **純粋関数を優先**: 副作用を最小限に
- **関数は短く**: 50行以内を目安

```javascript
// ❌ 悪い例: 複数の責任を持つ
function processData(data) {
  validateData(data);
  saveData(data);
  updateUI();
  sendNotification();
}

// ✅ 良い例: 責任を分離
function processData(data) {
  if (!validateData(data)) return false;
  saveData(data);
  return true;
}
```

#### エラー処理
- `try-catch`を適切に使用
- ユーザーにわかりやすいエラーメッセージを表示

```javascript
try {
  const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
} catch (error) {
  console.error('データの読み込みに失敗しました:', error);
  alert('データの読み込みに失敗しました。ページを再読み込みしてください。');
}
```

---

### HTML

#### セマンティックタグの使用
適切なHTML5セマンティックタグを使用する。

```html
<!-- ✅ 良い例 -->
<header>...</header>
<nav>...</nav>
<main>...</main>
<section>...</section>
<aside>...</aside>

<!-- ❌ 悪い例 -->
<div class="header">...</div>
<div class="nav">...</div>
```

#### アクセシビリティ
- `aria-*`属性を適切に使用
- `alt`属性を画像に必ず付ける
- `label`と`input`を関連付ける

```html
<button aria-label="メニューを開く" aria-expanded="false">☰</button>
<img src="icon.png" alt="アプリケーションアイコン" />
<label for="entry-date">日付</label>
<input type="date" id="entry-date" required />
```

#### フォームバリデーション
- HTML5のバリデーション属性を活用
```html
<input type="date" id="entry-date" required />
<input type="number" id="entry-amount" step="0.01" required />
<input type="text" id="entry-person" minlength="1" required />
```

---

### CSS

#### 命名規則
- **ケバブケース**（`kebab-case`）を使用
```css
.entry-form { ... }
.sidebar-toggle { ... }
.action-btn { ... }
```

#### クラス名の設計
- **BEMライク**の命名を推奨（厳密なBEMでなくても可）
```css
/* Block */
.cashbook { ... }

/* Element */
.cashbook-header { ... }
.cashbook-table { ... }

/* Modifier */
.cashbook--compact { ... }
```

#### セレクタの優先順位
1. クラスセレクタを優先
2. IDセレクタは控えめに
3. タグセレクタは最小限に

```css
/* ✅ 良い例 */
.positive { color: #4caf50; }
.entry-form input { padding: 0.5rem; }

/* ❌ 悪い例 */
#main-section div.content p { ... } /* 過度に具体的 */
```

#### レスポンシブデザイン
- モバイルファースト
- メディアクエリを適切に使用

```css
/* モバイル */
.entry-form {
  flex-direction: column;
}

/* タブレット以上 */
@media (min-width: 768px) {
  .entry-form {
    flex-direction: row;
  }
}
```

---

## ファイル構成

### ディレクトリ構造
```
MyHomeManager/
├── doc/                    # ドキュメント
│   ├── 開発ガイドライン.md    # このファイル
│   ├── 開発ログ.md           # 開発履歴
│   └── 詳細設計書.md         # システム設計
├── html/                   # HTMLファイル
│   ├── top.html
│   ├── cashbook.html
│   ├── calendar.html
│   └── settings.html
├── css/                    # CSSファイル
│   ├── common.css          # 共通スタイル
│   ├── top.css
│   ├── cashbook.css
│   ├── calendar.css
│   └── settings.css
└── js/                     # JavaScriptファイル
    ├── top.js
    ├── cashbook.js
    ├── calendar.js
    └── settings.js
```

### ファイル命名規則
- **小文字**のみ使用
- 複数単語は**ハイフン**で区切る（例: `cashbook-utils.js`）
- 日本語ファイル名は使用しない（ドキュメントを除く）

---

## データ管理

### LocalStorageキー命名規則
```javascript
// ✅ 良い例
const STORAGE_KEY = 'cashbookEntries';
const TASKS_KEY = 'tasks';
const EVENTS_KEY = 'calendarEvents';

// ❌ 悪い例
const key = 'data';
const userdata = 'ud';
```

### データ構造の一貫性
- JSON形式で保存
- 日付は`YYYY-MM-DD`形式
- 時刻は`HH:MM`形式（24時間表記）

```javascript
// 出納帳エントリの例
{
  date: "2025-11-30",
  amount: 10000,
  person: "山田太郎",
  type: "香典"
}
```

### データの保存・読み込みパターン
```javascript
// 保存
function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
}

// 読み込み
let entries = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
```

### データ変更のフロー
1. データ変更
2. `save()`を呼び出してLocalStorageに保存
3. `render()`を呼び出してUIを更新

---

## セキュリティ

### XSS対策（必須）
ユーザー入力を表示する際は、必ず`escapeHtml()`関数でエスケープする。

```javascript
function escapeHtml(text) {
  return String(text)
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#39;');
}

// 使用例
tr.innerHTML = `<td>${escapeHtml(e.person)}</td>`;
```

### バリデーション
- サーバーサイドがないため、クライアントサイドバリデーションが重要
- HTML5のバリデーション属性 + JavaScriptでの追加チェック

```javascript
if (!date || !person) {
  alert('日付と相手の名前は必須です');
  return;
}
```

---

## UI/UX設計

### 色の使用規則
- **背景色**: 白系（`#fff`, `#f5f5f5`など）
- **テキスト**: 黒系（`#333`, `#666`など）
- **プラス（収入）**: 緑系（`#4caf50`など）
- **マイナス（支出）**: 赤系（`#f44336`など）
- **アクション**: 青系（`#2196f3`など）
- **削除・警告**: 赤系（`#f44336`など）
- **キャンセル**: グレー系（`#757575`など）

### ボタンのスタイル
- 適切な`padding`（`0.4rem 0.8rem`程度）
- `border-radius`で角を丸く（`3px`程度）
- ホバー効果を必ず追加

```css
.action-btn {
  background: #2196f3;
  color: white;
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 4px;
  cursor: pointer;
  transition: background 0.2s;
}

.action-btn:hover {
  background: #1976d2;
}
```

### フォーム設計
- ラベルを明確に
- プレースホルダーを活用
- エラー表示は赤色で目立たせる

---

## テスト方針

### 手動テスト
新機能追加または修正後、必ず以下をテストする：

1. **基本機能テスト**
   - 追加、編集、削除が正常に動作するか
   - データがLocalStorageに保存されるか

2. **ページリロードテスト**
   - ページをリロードしてもデータが保持されるか

3. **エッジケーステスト**
   - 空のデータ、大量のデータでの動作確認
   - 不正な入力値の処理

4. **ブラウザテスト**
   - Chrome、Firefox、Edge、Safariで動作確認

### ブラウザ開発者ツールの活用
- **Console**: エラーログの確認
- **Application > Local Storage**: データの確認
- **Network**: （将来的に外部APIを使う場合）

---

## ドキュメント管理

### 開発ログの更新
機能追加・修正を行った際は、必ず`doc/開発ログ.md`に記録する。

**記録内容**:
- 日付・時刻
- 作業内容
- 変更したファイル
- 検証結果

### コードコメント
- 複雑なロジックには説明を付ける
- 将来の改善点は`// TODO:`でマーク
- 既知の問題は`// FIXME:`でマーク

```javascript
// TODO: CSV形式でのエクスポートに対応
// FIXME: 大量データでのパフォーマンス改善が必要
```

---

## 開発フロー

### 新機能開発の標準フロー
1. **要件確認**: 何を実装するか明確にする
2. **設計**: 必要なデータ構造、関数を設計
3. **実装**: ガイドラインに従ってコーディング
4. **テスト**: 動作確認
5. **ドキュメント更新**: 開発ログに記録
6. **コミット**: （バージョン管理を使用する場合）

### 修正作業の標準フロー
1. **問題特定**: 何が問題かを明確にする
2. **原因調査**: コードを読んで原因を特定
3. **修正**: 最小限の変更で修正
4. **テスト**: 修正が正しく動作するか確認
5. **リグレッションテスト**: 他の機能に影響がないか確認
6. **ドキュメント更新**: 開発ログに記録

---

## チェックリスト

### コード提出前チェックリスト
- [ ] ガイドラインに従っているか
- [ ] コードにコメントを適切に付けたか
- [ ] `escapeHtml()`でXSS対策をしたか
- [ ] ブラウザで動作確認をしたか
- [ ] ページリロード後もデータが保持されるか確認したか
- [ ] 開発ログを更新したか
- [ ] コンソールにエラーが出ていないか確認したか

---

## 改訂履歴

| 日付 | バージョン | 変更内容 | 更新者 |
|------|-----------|---------|--------|
| 2025-11-30 | 1.0.0 | 初版作成 | AI開発アシスタント |

---

**このガイドラインに従って、一貫性のある高品質なコードを書きましょう！**
